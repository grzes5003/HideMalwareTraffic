import time

from packet_gen.packet_generator import ConnInfo, PacketGenerator
from util.data_constants import GEN
import pandas as pd
import itertools
import logging


class LocalService:
    @staticmethod
    def send_traffic(path):
        df = pd.read_csv(path)
        for _, row in itertools.islice(df.iterrows(), 10):
            cols = ['Dur', 'SrcBytes', 'DstBytes', 'SrcLoad', 'DstLoad', 'SrcRate', 'DstRate', 'SrcPkts', 'DstPkts']
            if any(row[col] == 0 for col in cols):
                continue
            src_info, dst_info = ConnInfo(4144, row['sTos'], row['SrcBytes'], row['SrcLoad'], row['SrcRate'],
                                          row['SrcPkts'], addr="192.168.0.234"), \
                                 ConnInfo(5051, row['dTos'], row['DstBytes'], row['DstLoad'], row['DstRate'],
                                          row['DstPkts'], addr="192.168.0.234")
            logging.info(f'{src_info=}, {dst_info=}')
            PacketGenerator.generate_client_packet(src_info, dst_info)


if __name__ == '__main__':
    logging.basicConfig(format='%(asctime)s|%(name)s|%(levelname)s| %(message)s', level=logging.DEBUG)
    path = f'..\\saved_data\\wgan_{GEN}_data_generated_0_desc_cont_prepared_flows.csv'

    LocalService.send_traffic(path)
