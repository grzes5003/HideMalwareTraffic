from util.preprocessors import add_labels
from util.data_constants import GEN, GEN3_MIXED
from GAN.vanilla_mix_gan import latent_dim
from unittest import TestCase
import tensorflow as tf
import numpy as np
import keras
import os


class TestWganGP(TestCase):
    def test_generate_data(self):
        g_model = keras.models.load_model(f'..\\saved_models\\{GEN}\\gen')

        random_latent_vectors = tf.random.normal(mean=-0.5, stddev=1.5, shape=(500, latent_dim))
        generated_images = g_model(random_latent_vectors)

        arr = np.array(generated_images)
        arr = np.squeeze(arr)

        i = 0
        while os.path.exists(f'..\\saved_data\\wgan_{GEN}_data_generated_{i}.csv'):
            i += 1

        np.savetxt(f'..\\saved_data\\wgan_{GEN}_data_generated_{i}.csv', arr, delimiter=',')

        add_labels(f'..\\saved_data\\wgan_{GEN}_data_generated_{i}.csv', GEN3_MIXED.all_tags_after_mixed)
        # quantify_data(f'..\\saved_data\\wgan_{GEN}_data_generated_{i}.csv', gen2=True)
