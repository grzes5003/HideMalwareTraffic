import keras
from sklearn import metrics
import numpy as np
import pandas as pd
import tensorflow as tf
from tensorflow.keras.models import Sequential
from tensorflow.keras.layers import Dense, Activation
from sklearn.model_selection import train_test_split


def load_model():
    model = keras.models.load_model('saved_models/model01')
    return model


def fit():
    model = load_model()

    df_normal = pd.read_csv('saved_data/KDDTrainData/df_normal.csv')
    df_attack = pd.read_csv('saved_data/df_attack.csv')

    df_normal.drop('Unnamed: 0', axis=1, inplace=True)
    df_attack.drop('Unnamed: 0', axis=1, inplace=True)

    x_normal = df_normal.values
    x_attack = df_attack.values

    x_normal_train, x_normal_test = train_test_split(
        x_normal, test_size=0.25, random_state=42)

    pred = model.predict(x_normal_test)
    score1 = np.sqrt(metrics.mean_squared_error(pred, x_normal_test))
    pred = model.predict(x_normal)
    score2 = np.sqrt(metrics.mean_squared_error(pred, x_normal))
    pred = model.predict(x_attack)
    score3 = np.sqrt(metrics.mean_squared_error(pred, x_attack))
    print(f"Out of Sample Normal Score (RMSE): {score1}")
    print(f"Insample Normal Score (RMSE): {score2}")
    print(f"Attack Underway Score (RMSE): {score3}")


if __name__ == "__main__":
    fit()
