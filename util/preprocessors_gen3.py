import pandas as pd


def remove_special_chars(path):
    with open(path, 'r') as infile:
        data = infile.read()
        data = data.replace('*', '')
    with open(path, 'w') as outfile:
        outfile.write(data)


def prepare_recorded_data(_path, _ip_list):
    remove_special_chars(_path)

    # prepare timestamp
    df = pd.read_csv(_path)
    df.dropna(inplace=True)
    df.replace({'*': ''})

    df.drop(['SrcLoad', 'DstLoad', 'SynAck', 'AckDat', 'RunTime'], inplace=True, axis=1)

    df_groups = df.groupby(by=['Dport', 'Sport', 'SrcAddr', 'DstAddr'])
    df_list = [(n, d) for n, d in df_groups if d['Cause'].iloc[0] == 'Start' and len(d) > 1 and 'tcp' in d['Proto'].unique()]
    padding_len = max([len(d) for _, d in df_list])

    for n, d in df_list:
        d['StartTime'] = d['StartTime'].diff()
        d.drop(['Dport', 'Sport', 'Proto', 'DstAddr', 'SrcAddr'], inplace=True, axis=1)

        # list(reversed(sorted([(len(d), d['Proto']) for _, d in df_groups])))
        ...


def create_data_mix(a,):
    pass


if __name__ == '__main__':
    ip_list = ['2a00:1450:401b:80d::200e', '2a00:1450:401b:80e::2016', '2a03:2880:f016:19:face:b00c:0:2825',
               '35.186.224.47', '20.199.120.151', '198.252.206.25']

    prepare_recorded_data('..\\saved_data\\custom_data\\p2_spotify_gen3_deli.csv', ip_list)
    print('done')
    # prepare_recorded_data_gen2('..\\saved_data\\custom_data\\p3_raw.csv')
    # prepare_recorded_data_as_cont('..\\saved_data\\custom_data\\p3_raw.csv')
