import numpy as np
import pandas as pd


def sum_of_pkts(_path):
    df = pd.read_csv(_path)
    df.dropna(inplace=True)
    df.replace({'*': ''})


def ack_pckt_present(_path):
    df = pd.read_csv(_path)
    df.dropna(inplace=True)
    df.replace({'*': ''})

    return df[df['SrcPkts'] == 0]['SrcPkts'].count()/df['SrcPkts'].count()


def max_size_exceeded(_path):
    df = pd.read_csv(_path)
    df.dropna(inplace=True)
    df.replace({'*': ''})

    return (df[df['SrcBytes']/df['SrcPkts'] > 1448]['SrcBytes'].count() / df['SrcBytes'].count(),
            df[df['DstBytes']/df['SrcPkts'] > 1448]['DstBytes'].count() / df['DstBytes'].count())


def max_thp(_path, _ref):
    ref = pd.read_csv(_ref)
    ref.dropna(inplace=True)
    ref.replace({'*': ''})

    df = pd.read_csv(_path)
    df.dropna(inplace=True)
    df.replace({'*': ''})

    ref_src = ref['SrcBytes'] / ref['Dur']
    ref_dst = ref['DstBytes'] / ref['Dur']

    ref_src.replace([np.inf, -np.inf], np.NaN, inplace=True)
    ref_dst.replace([np.inf, -np.inf], np.NaN, inplace=True)

    ref_src.dropna(inplace=True)
    ref_dst.dropna(inplace=True)

    # ref_src
    #
    ref_src = ref_src.max()*8
    ref_dst = ref_dst.max()*8

    val1 = df['SrcBytes']/df['Dur']
    val2 = df['DstBytes']/df['Dur']
    return ((val1[val1 >= ref_src].count()/df['SrcPkts'].count())*8,
            (val2[val2 >= ref_dst].count()/df['DstPkts'].count())*8)


def mean_thp(_path):
    df = pd.read_csv(_path)
    df.dropna(inplace=True)
    df.replace({'*': ''})

    val1 = (df['SrcBytes']/df['Dur']).mean()
    val2 = (df['DstBytes']/df['Dur']).mean()
    return (val1*8, val2*8)


if __name__ == '__main__':
    DATA_CSV_PATH = '..\\saved_data\\custom_data2\\p2_spotify_gen3_prepared_raw.csv'

    vals = {
    # gan8
    'GAN8' : f'..\\saved_data\\wgan_GEN_52_data_generated_0_cols_decoded.csv',
    # gan74
    'GAN74' : f'..\\saved_data\\wgan_GEN_53_data_generated_1_cols_decoded.csv',

    # wgan8
    'WGAN8' : f'..\\saved_data\\wgan_GEN_51_data_generated_2_cols_decoded.csv',
    # wgan74
    'WGAN74' : f'..\\saved_data\\wgan_GEN_54_data_generated_4_cols_decoded.csv',

    # vae8
    'VAE8' : f'..\\saved_data\\vae_GEN_52_data_generated_0_cols.csv',
    # vae74
    'VAE74' : f'..\\saved_data\\vae_GEN_55_data_generated_0_cols_decoded.csv',
    }

    # [print(f'{key}={ack_pckt_present(vals[key])}') for key in vals]
    [print(f'{key}={max_size_exceeded(vals[key])}') for key in vals]
    print(max_size_exceeded(DATA_CSV_PATH))
    # [print(f'{key}={max_thp(vals[key],DATA_CSV_PATH)}') for key in vals]
    # print(mean_thp(DATA_CSV_PATH))

